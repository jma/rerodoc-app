{% import 'rerodoc/record_brief.html' as record_brief %}
{% extends config.BASE_TEMPLATE %}

{%- macro metadata(data, config) %}
  {% for conf in config %}
    {% set parent_loop = loop %}
    {% for key in conf %}
      {% if key in data %}
        <dt>{{ _(key) | title }}</dt>
        <dd>{{ key | format_metadata(data, current_i18n.locale.language) | safe }}</dd>
        {% if loop.last and not parent_loop.last %}
          <hr/>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endfor %}

{%- endmacro %}

{%- macro record_content(data) %}
  {% for key, value in data.items() recursive %}
    <li class="list-group-item">
    {% if value is mapping %}
        <strong>{{ key }}:</strong>
        <ul class="list-group">{{ loop(value.items()) }}</ul>
    {% elif value is iterable and value is not string %}
        <strong>{{ key }}:</strong>
        <ol>
        {% for item in value %}
          <li>
          {% if item is mapping %}
            <ul class="list-group">
              {{ record_content(item) }}
            </ul>
          {% else %}
            {{ item }}
          {% endif %}
          </li>
        {% endfor %}
        </ol>
    {% else %}
      <strong>{{ key }}:</strong> {{ value }}
    {% endif %}
    </li>
  {% endfor %}
{%- endmacro %}

{%- macro menu_box(title, entries) %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">{{ _(title) }}</h3>
      </div>
      <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
        {% for item in entries %}
          <li role="presentation">
            <a href={{ item.url }}>
                {{ _(item.label) }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
{%- endmacro %}

{%- block page_body %}
<div class="container">

  {%- block record_body %}
  <div class="row">
  <div class="detail col-md-12">
    {% if record %}
    {{ record_brief.briefs(record) }}
    {% endif %}
  </div>
  </div>
  {%- endblock %}

  <div class="row">
  {%- block record_menu %}
  <div class="detail col-md-3">
    {{ menu_box(_('See also'), [{'label': 'Similar Records', 'url': '#'}]) }}
    {{ menu_box(_('Links'), [{'label': 'Permalink', 'url': record|permalink}]) }}
    {{ menu_box(_('Share'), [
      {'label': 'LinkedIn', 'url': '#'},
      {'label': 'Facebook', 'url': record|facebook},
      {'label': 'Tweeter', 'url': '#'}
      ])
    }}
    {{ menu_box(_('Export As'), [
      {'label': 'JSON', 'url': url_for('invenio_records_ui.recid_export', pid_value=record.get('recid'), format='json')},
      {'label': 'MarcXML', 'url': url_for('invenio_records_ui.recid_export', pid_value=record.get('recid'), format='xm')},
      {'label': 'JSON-LD', 'url': url_for('invenio_records_ui.recid_export', pid_value=record.get('recid'), format='ld')},
      {'label': 'Turtle', 'url': url_for('invenio_records_ui.recid_export', pid_value=record.get('recid'), format='turtle')},
      {'label': 'RDF', 'url': url_for('invenio_records_ui.recid_export', pid_value=record.get('recid'), format='rdf')}
      ])
    }}
  </div>
  {%- endblock %}

  {%- block record_metadata %}
  <div class="col-md-9">
  {% if record %}

  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#details" aria-controls="details" role="tab" data-toggle="tab">Details</a></li>
    <li role="presentation"><a href="#summary" aria-controls="summary" role="tab" data-toggle="tab">Summary</a></li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="details">
    <p>
    <dl class="dl-horizontal">
    {% set config=[
      ['title', 'other_title', 'authors',
       'corporate', 'document_type'],
      ['edition'],
      ['geographical_info', 'sequential_designation'],
      ['publication', 'publication_date'],
      ['collation'],
      ['series'],
      ['thesis_note', 'defense_date',
       'language', 'frequency',
       'note', 'content_note',
       'access_restriction', 'jury',
       'performers', 'reproduction', 'meeting',
       'host_item_entry', 'other_edition'],
       ['udc', 'keyword'],
       ['isbn10', 'isbn13', 'urn', 'doi', 
       'oai', 'isrn', 'rero_id', 'report_number', 'submission_number'
       ]
      ]
     %}
      {{ metadata(record, config) }}
    </dl>
    </p>
    </div>
    <div role="tabpanel" class="tab-pane" id="summary">
    <p>
    <dl>
      {% for summ in record.summary %}
      <dt>{{ summ.lang | translate_language(current_i18n.locale.language) }}</dt>
      <dd>
      <p>
        {{ summ.content }}
      </p>
      </dd>
      {% endfor %}
      </dl>
      </p>
    </div>
  </div>


  {% endif %}
  </div>
  {%- endblock %}
  </div>

</div>
{%- endblock page_body %}